<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Registro | PangolesGames</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<nav class="navbar navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">PangolesGames</a>
  </div>
</nav>

<main class="container py-5">

  <h1 class="text-center mb-4">Criar conta</h1>

  <form id="form-registro" class="mx-auto" style="max-width:420px">
    <div class="mb-3">
      <label class="form-label">Nome</label>
      <input id="nome" type="text" class="form-control" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Email</label>
      <input id="email" type="email" class="form-control" required>
    </div>

    <div class="mb-3">
      <label class="form-label">Senha</label>
      <input id="senha" type="password" minlength="4" class="form-control" required>
    </div>

    <button class="btn btn-primary w-100" type="submit">Criar conta</button>
  </form>

</main>

<!-- CARREGA TUDO JUNTO -->
<script type="module">
  // Importa tudo de uma vez
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { 
    getAuth, 
    createUserWithEmailAndPassword 
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
  import { 
    getFirestore, 
    doc, 
    setDoc 
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  // ConfiguraÃ§Ã£o do Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDIi2Jw47fjlQ16G8qAMIFnfqNrKttLigs",
    authDomain: "ecommerce-e7f84.firebaseapp.com",
    projectId: "ecommerce-e7f84",
    storageBucket: "ecommerce-e7f84.appspot.com",
    messagingSenderId: "747354700150",
    appId: "1:747354700150:web:66ab6bba6a9c3b436fe257",
    measurementId: "G-NZ3R9TCYZK"
  };

  // Inicializa Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  console.log("ðŸ”¥ Firebase pronto!");

  // Configura o formulÃ¡rio
  document.getElementById("form-registro").addEventListener("submit", async (e) => {
    e.preventDefault();

    const nome = document.getElementById("nome").value.trim();
    const email = document.getElementById("email").value.trim().toLowerCase();
    const senha = document.getElementById("senha").value;

    // 1. SALVAR NO LOCALSTORAGE
    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
    if (usuarios.find(u => u.email === email)) {
      alert("JÃ¡ existe uma conta com esse email.");
      return;
    }

    const novo = { nome, email, senha, role:"cliente" };
    usuarios.push(novo);
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
    localStorage.setItem("currentUser", JSON.stringify(novo));

    // 2. SALVAR NO FIREBASE
    try {
      const cred = await createUserWithEmailAndPassword(auth, email, senha);
      const uid = cred.user.uid;

      await setDoc(doc(db, "users", uid), {
        uid,
        nome,
        email,
        role: "cliente",
        criado_em: new Date().toISOString()
      });

      console.log("ðŸ”¥ UsuÃ¡rio salvo no Firebase!");
      alert("Conta criada com sucesso!");
      window.location.href = "meus-pedidos.html";

    } catch (err) {
      console.error("Erro Firebase:", err);
      alert("Erro Firebase: " + err.message);
    }
  });
</script>

</body>
</html>