<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Carrinho | PangolesGames</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

  <nav class="navbar navbar-dark bg-dark">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">PangolesGames</a>
      <a class="btn btn-outline-light" href="produtos.html">Voltar</a>
    </div>
  </nav>

  <main class="container py-5">
    <h1 class="text-center fw-bold mb-4">ðŸ›’ Seu Carrinho</h1>

    <div id="area-carrinho"></div>

    <div id="acoes" class="text-center mt-4">
      <a href="produtos.html" class="btn btn-outline-secondary">Continuar comprando</a>
      <button id="limpar" class="btn btn-danger">Esvaziar carrinho</button>
      <a id="btn-checkout" href="checkout.html" class="btn btn-success">Finalizar compra</a>
    </div>
  </main>

  <footer class="bg-dark text-white text-center py-3 mt-5">Â© 2025 PangolesGames</footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // helpers
    function brl(v){ return v.toLocaleString('pt-BR',{minimumFractionDigits:2, maximumFractionDigits:2}); }

    // carrega
    let carrinho = JSON.parse(localStorage.getItem('carrinho')) || [];

    function salvar(){ localStorage.setItem('carrinho', JSON.stringify(carrinho)); }

    function calcularTotal(){ return carrinho.reduce((acc,i)=> acc + i.preco * i.quantidade, 0); }

    function render() {
      const area = document.getElementById('area-carrinho');
      if (carrinho.length === 0) {
        area.innerHTML = '<p class="text-center text-muted">Seu carrinho estÃ¡ vazio.</p>';
        document.getElementById('btn-checkout').classList.add('disabled');
        return;
      }
      let html = '<div class="table-responsive"><table class="table align-middle text-center"><thead class="table-dark"><tr><th>Produto</th><th>PreÃ§o</th><th>Qtd</th><th>Subtotal</th><th>AÃ§Ãµes</th></tr></thead><tbody>';
      carrinho.forEach((it, idx) => {
        html += `<tr>
          <td>${it.nome}</td>
          <td>R$ ${brl(it.preco)}</td>
          <td>
            <div class="d-flex justify-content-center align-items-center">
              <button class="btn btn-sm btn-outline-secondary me-2" onclick="alterar(${idx}, -1)">âˆ’</button>
              <input type="number" min="1" value="${it.quantidade}" onchange="setQuantidade(${idx}, this.value)" style="width:70px" class="form-control form-control-sm text-center">
              <button class="btn btn-sm btn-outline-secondary ms-2" onclick="alterar(${idx}, 1)">+</button>
            </div>
          </td>
          <td>R$ ${brl(it.preco * it.quantidade)}</td>
          <td><button class="btn btn-sm btn-danger" onclick="remover(${idx})">Remover</button></td>
        </tr>`;
      });
      html += `</tbody></table></div>
        <div class="text-end"><h5>Subtotal: R$ ${brl(calcularTotal())}</h5><h3 class="fw-bold">Total: R$ ${brl(calcularTotal())}</h3></div>`;
      area.innerHTML = html;
      document.getElementById('btn-checkout').classList.remove('disabled');
    }

    function alterar(i,delta){
      let q = carrinho[i].quantidade + delta;
      if (q < 1) q = 1;
      carrinho[i].quantidade = q;
      salvar(); render();
    }
    function setQuantidade(i, value){
      let q = parseInt(value);
      if (isNaN(q) || q < 1) q = 1;
      carrinho[i].quantidade = q;
      salvar(); render();
    }
    function remover(i){
      if (!confirm('Remover este item?')) return;
      carrinho.splice(i,1); salvar(); render();
    }

    document.getElementById('limpar').addEventListener('click', () => {
      if (!confirm('Esvaziar carrinho?')) return;
      carrinho = []; salvar(); render();
    });

    // ao ir para checkout salva os itens em outra chave (opcional)
    document.getElementById('btn-checkout').addEventListener('click', () => {
      localStorage.setItem('checkoutItems', JSON.stringify(carrinho));
    });

    // inicializa
    render();
  </script>
</body>
</html>
